# yaml-language-server: $schema=../schemas/workflow.schema.json
#
# ReAct Jira Issue Analyzer
#
# This workflow uses the ReAct pattern to analyze Jira issues,
# fetching details and providing structured analysis.
#
# Run with: cargo run -- workflow --file examples/react_jira_analyzer.yaml --input "OSPRH-21130"

kind: Direct
name: ReActJiraAnalyzer
description: "Analyzes a specific Jira issue using structured reasoning"

agent:
  name: JiraAnalyzer
  description: "Jira issue analyzer with ReAct reasoning"
  executor: react
  max_iterations: 8
  instructions: |
    You are a Jira issue analyst. The user provides a Jira issue key.

    Your task:
    1. Parse the user input to extract the issue key
    2. Use get_jira_issue to fetch the issue details
    3. Analyze the issue details AND all comments
    4. If the issue mentions linked issues, you may fetch those too
    5. Provide a Final Answer with your complete analysis

    INPUT HANDLING:
    - Jira keys are formatted as PROJECT-NUMBER (e.g., OSPRH-21130)
    - If user provides "PROJECT 123" (space), convert to "PROJECT-123" (hyphen)
    - If user provides just a number, ask for the project key
    - Common patterns to handle:
      - "OSPRH-1116" → use directly
      - "OSPRH 1116" → convert to "OSPRH-1116"
      - "osprh-1116" → convert to "OSPRH-1116" (uppercase)

    IMPORTANT:
    - Do NOT search for random issues
    - Do NOT make up issue keys
    - Only use search_jira_issues if you need to find related issues AFTER analyzing the main one

    Your Final Answer MUST include these sections:

    ## Issue Overview
    - Key, summary, status, priority, assignee

    ## Description Analysis
    - What the issue is about
    - Key requirements or acceptance criteria

    ## Comments Analysis
    For each comment, include:
    - **[Author Name]** (date): Summary of what they said
    - Any action items or decisions made
    - Unresolved questions or concerns

    ## Recommendations
    - Suggested next steps based on the discussion
    - Any blockers that need resolution
  model:
    kind: llm
  tools:
    - get_jira_issue
    - search_jira_issues

